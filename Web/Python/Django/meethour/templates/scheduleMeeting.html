{% load static %}
<!doctype html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Meet Hour Python Django Example (Schedule Meeting Page)</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0" />
    <link href="https://portal.meethour.io/dist/images/favicon.png" rel="shortcut icon" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/loader.css' %}">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/JavaScript" src=" https://MomentJS.com/downloads/moment.js"></script>
</head>  

<body>
    <div>
        <div>
            {% include 'header.html' %}
         </div>
         <div class="relative top-16">
            {% if error == True %} 
               <div id="error">
                  <div class="flex fixed top-20 justify-center items-center text-lg font-medium w-96 rounded-md h-16 border border-red-600 bg-red-50 text-red-600">
                     <p>{{message}}</p>
                  </div>
               </div>
               {% endif %}
        <div class="lg:flex w-screen relative top-16 justify-between overflow-x-hidden">
            {% if error == True %} 
                <div id="error">
                    <div class="flex fixed top-20 justify-center items-center text-lg font-medium w-96 rounded-md h-16 border border-red-600 bg-red-50 text-red-600">
                    </div>
                </div>
                {% endif %}
            <div class="lg:w-[60%] overflow-hidden bg-white shadow sm:rounded-lg">
                <div class="px-4 py-5 sm:px-6">
                    <h3 class="text-lg font-medium leading-6 text-gray-900">How to Schedule a Meeting</h3>
                    <p class="mt-1 text-sm text-gray-500">Steps given below - </p>
                </div>
                <div class="border-t border-gray-200"> 
                    <dl>
                        <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                            <dt class="text-sm font-medium text-gray-500">Step One</dt>
                            <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">Fill the required fields like
                                meeting name, passcode, meeting date, meeting time, meeting meridiem and timezone in the
                                Schedule a Meeting Form.<br><span class="text-xs">Note: You have to set a moderator to
                                    start
                                    the meeting. If you do not set a moderator, meeting can not start.</span></dd>
                        </div>
                        <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                            <dt class="text-sm font-medium text-gray-500">Step Two</dt>
                            <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">After adding all the necessary
                                fields, now add participants and moderators. Note: To start a meeting, atleast one
                                moderator
                                is required.</dd>
                        </div>
                        <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                            <dt class="text-sm font-medium text-gray-500">Step Three</dt>
                            <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">You can choose general options
                                according to your requirements.</dd>
                        </div>
                        <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                            <dt class="text-sm font-medium text-gray-500">Step Four</dt>
                            <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">After filling all the fields,
                                now
                                you can click on Schedule a Meeting button which will take you to the joining page.</dd>
                        </div>
                        <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                            <dt class="text-sm font-medium text-gray-500">Step Five</dt>
                            <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">In joining page you will be
                                asked,
                                whom do you want to join as. Choose and go ahead to the meeting.</dd>
                        </div>
                        <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                            <dt class="text-sm font-medium text-gray-500">Step Six</dt>
                            <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">When clicked on Instant
                                Meeting, a
                                quick meeting will be scheduled. </dd>
                        </div>
                    </dl>
                </div>
            </div>
            <div class="flex min-h-full items-center justify-center lg:w-[40%] pb-6 px-4 sm:px-3 lg:px-4 ml-3">
                <div class="w-full max-w-sm space-y-8">
                    <div>
                        <h2 class="mt-6 text-center text-3xl font-bold tracking-tight text-gray-900">Schedule a meeting
                        </h2>
                    </div>
                    <div class="mt-8 space-y-6"><input type="hidden" name="remember" value="true">
                        <form action="/schedulemeeting/" method="post">
                            {% csrf_token %}
                            <div class="-space-y-px rounded-md shadow-sm grid gap-5">
                                <h2 style="margin-top: 15px;">Meeting Name</h2>
                                <div><label for="meeting_name" class="sr-only">Meeting Name</label><input required id="meeting_name" name="meeting_name" type="text" class="appearance-none rounded-none relative block
                      w-full px-3 py-2 border border-gray-300
                      placeholder-gray-500 text-gray-900 rounded-b-md
                      focus:outline-none focus:ring-indigo-500
                      focus:border-indigo-500 focus:z-10 sm:text-sm" placeholder="Meeting Name"></div>
                                <h2 style="margin-top: 15px;">Passcode</h2>
                                <div><label for="passcode" class="sr-only">Passcode</label><input required id="passcode" name="passcode" type="text" minlength="6" class="appearance-none rounded-none relative block
                      w-full px-3 py-2 border border-gray-300
                      placeholder-gray-500 text-gray-900 rounded-b-md
                      focus:outline-none focus:ring-indigo-500
                      focus:border-indigo-500 focus:z-10 sm:text-sm" placeholder="Passcode"></div>
                                <h2 style="margin-top: 15px;">Meeting Date</h2>
                                <div><label for="meeting_date" class="sr-only">Meeting Date</label><input required id="meeting_date" name="meeting_date" type="date" class="appearance-none rounded-none relative block
                      w-full px-3 py-2 border border-gray-300
                      placeholder-gray-500 text-gray-900 rounded-b-md
                      focus:outline-none focus:ring-indigo-500
                      focus:border-indigo-500 focus:z-10 sm:text-sm" placeholder="Passcode"></div>
                                <h2 style="margin-top: 15px;">Meeting Time</h2>
                                <div><label for="meeting_time" class="sr-only">Meeting Time</label><input required id="meeting_time" name="meeting_time" type="time" class="appearance-none rounded-none relative block
                      w-full px-3 py-2 border border-gray-300
                      placeholder-gray-500 text-gray-900 rounded-b-md
                      focus:outline-none focus:ring-indigo-500
                      focus:border-indigo-500 focus:z-10 sm:text-sm" placeholder="Meeting Time"></div>
                                <h2 style="margin-top: 15px;">Timezone</h2>
                                <div class='w-full h-10 rounded-md'>
                                    <select class='w-full h-full rounded-md focus:outline-none bg-slate-50 border border-slate-300' name="timezone" id="timezone">
                                            <option key="0" class="w-96" value="">Select Timezone</option>
                                            {% for timezone_option in timezone_response %}
                                            <option value="{{ timezone_option.value }}">{{ timezone_option.name }}</option>
                                                {% endfor %}
                                    </select>                                   
                                </div>
                                <div class="relative inline-block text-left" data-headlessui-state="" style="margin-bottom: 35px;">
                                    <div>
                                        <h2 style="margin-top: 15px;">Choose Participants</h2>
                                        <select name="mySelectParticipants" id="mySelectParticipants" onchange="addParticipant(this)" class="absolute right-0 z-10 mt-2 w-56 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none transform opacity-100 scale-100 inline-flex w-full justify-between rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-gray-100" style="width: 100%;">
                                            <option key="0" class="w-96" value="">Select Participants</option>
                                            {% for index in contacts_response %}
                                                <option key="{{ forloop.counter }}" class="w-96" value="{{ index.id }}">{{ index.email }} - {{ index.first_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div> 
                                </div>
                                <div id="participants-display" class="grid gap-2"></div>
                                <h2 style="margin-top: 15px;">Add Participant Manually</h2>
                                <div class="flex justify-right"><a  class="group relative flex w-full justify-center rounded-md border border-transparent bg-sky-600 py-2 px-4 text-sm font-medium text-white hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2" onclick="$('#modal2').show();" >Add New Contact</a></div>
                            
                                <div class="relative inline-block text-left" data-headlessui-state="" style="margin-bottom: 35px;">
                                    <div>
                                        <h2 style="margin-top: 15px;">Choose Moderators</h2>
                                        <select name="mySelectModerators" id="mySelectModerators" onchange="addParticipant(this)" class="absolute right-0 z-10 mt-2 w-56 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none transform opacity-100 scale-100 inline-flex w-full justify-between rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-gray-100" style="width: 100%;">
                                            <option key="0" class="w-96" value="">Select Moderators</option>
                                            {% for index in contacts_response %}
                                                <option key="{{ forloop.counter }}" class="w-96" value="{{ index.id }}">{{ index.email }} - {{ index.first_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <input type="hidden" id="attendArray" name="attendArray" value="[]">
                                <input type="hidden" id="hostusersArray" name="hostusersArray" value="[]">
                                <div id="moderators-display" class="grid gap-2">

                                </div>
                                <div class=''>
                                    <p class="mt-3 text-sm">General Options</p>
                                    <div class="flex items-start mt-2">
                                        <div class="flex h-5 items-center"><input type="checkbox" id="options" name="options" class="h-4 w-4 rounded text-indigo-600 focus:ring-indigo-500" value="ALLOW_GUEST"></div>
                                        <div class="ml-3 text-sm"><label for="options" class="font-medium text-gray-700">Guest user can join meeting</label></div>
                                    </div>
                                </div>
                            </div>
                            <div id="manual-meeting-loader" class="flex justify-center"></div>
                            <input type="hidden" name="schedulemeeting" value="true" />
                            <div class="mt-3"><button type="submit" id="schedule-meeting-button" class="group relative flex w-full justify-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"><span class="absolute inset-y-0 left-0 flex items-center pl-3"></span>Schedule a
                                    meeting</button>
                                <div class="flex justify-center">
                                    <h1 class="my-3">Or</h1>
                                </div>
                            </div>
                        </form>
                        <div id="instant-meeting-loader" class="flex justify-center"></div>
                        <form action="/schedulemeeting/" class="flex justify-center gap-1 mt-3" method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="instantmeeting" value="true" />
                            <button type="submit" class="group relative flex w-full justify-center rounded-md border border-transparent bg-violet-600 py-2 px-4 text-sm font-medium text-white hover:bg-violet-700 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2">Instant Meeting</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div id="modal2" style="display:none;">
            <div>
                <div class="relative z-10" id="headlessui-dialog-5" role="dialog" aria-modal="true" data-headlessui-state="open">
                    <div class="fixed inset-0 bg-gray-700 bg-opacity-75 transition-opacity opacity-100"></div>
                    <div class="fixed inset-0 z-10 overflow-y-auto">
                        
                        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                            <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg opacity-100 translate-y-0 sm:scale-100" id="headlessui-dialog-panel-6" data-headlessui-state="open">
                                <div style="position: absolute;right: 1rem;">
                                    <button type="button" class="close-modal text-black-600 text-3xl" data-dismiss="alert" aria-label="Close" onclick="closeModal2()"><span aria-hidden="true">&times;</span></button>
                                </div>
                                <div class="p-8 grid gap-2">
                                    <div class="h-14 flex justify-center items-center w-full rounded-lg bg-green-100 text-green-600">Add Participant Manually</div>
                                        <div  class="font-semibold text-gray-600">First Name<input id="firstname" type="text" required=""
                                            class="appearance-none rounded-none relative block
                                                w-full px-3 py-2 border border-gray-300
                                                placeholder-gray-500 text-gray-900 rounded-b-md
                                                focus:outline-none focus:ring-indigo-500
                                                focus:border-indigo-500 focus:z-10 sm:text-sm" placeholder="First Name"></div>
                                    <div  class="font-semibold text-gray-600">Last Name <input id="lastname" type="text" required=""
                                            class="appearance-none rounded-none relative block
                                                w-full px-3 py-2 border border-gray-300
                                                placeholder-gray-500 text-gray-900 rounded-b-md
                                                focus:outline-none focus:ring-indigo-500
                                                focus:border-indigo-500 focus:z-10 sm:text-sm" placeholder="Last Name"></div>
                                    <div  class="font-semibold text-gray-600">Email<input id="email" type="email" required="" class="appearance-none rounded-none relative block
                                                w-full px-3 py-2 border border-gray-300
                                                placeholder-gray-500 text-gray-900 rounded-b-md
                                                focus:outline-none focus:ring-indigo-500
                                                focus:border-indigo-500 focus:z-10 sm:text-sm" placeholder="Email"></div>
                                    <div class="flex justify-center">
                                        <button type="button" id="addcontactbtn" value="Submit" class="bg-emerald-600 font-semibold px-4 py-2 mt-1 text-white rounded-md">Add Contact</button></a></div>
                                    </div>   
                                    <script>
                                        $(document).ready(function() {
                                            $('#addcontactbtn').click( function(event) {
                                                //event.preventDefault(); // Prevent the form from submitting the traditional way
                                
                                                var formData = {
                                                    firstname: $('#firstname').val(),
                                                    lastname: $('#lastname').val(),
                                                    email: $('#email').val()
                                                };
                                                alert(JSON.stringify(formData));
                                           
                                
                                                $.ajax({
                                                    type: 'POST',
                                                    url: '/addcontact', // Replace with your server endpoint
                                                    data: formData,
                                                    dataType: 'json',
                                                    encode: true,
                                                    success: function(response) {
                                                        if(response.data)
                                                    {
                                                        console.log('Form submitted successfully:', response.data);
                                
                                                        // Assuming response is a JSON object with id, firstname, lastname, email
                                                        var option = $('<option></option>');
                                                        option.attr('key', response.data.id)
                                                        option.addClass('w-96')
                                                        option.attr('value', response.data.id)
                                                        option.text(response.data.first_name + " " + response.data.last_name);
                                
                                                        $('#mySelectParticipants').append(option);
                                                        $('#mySelectParticipants').val(response.data.id);
                                                    }
                                                    else {
                                                            if(response.message)
                                                            {
                                                                alert(response.message);
                                                            }
                                                            else {
                                                                alert("Unknown error");
                                                            }
                                                        }
                                                        closeModal2();
                                                    },
                                                    error: function(error) {
                                                        console.log('Error submitting form:', error);
                                                    }
                                                });
                                            });
                                        });
                                    </script>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            function closeModal2() {
                var modal = document.getElementById("modal2");
                modal.style.display = "none";
            }
        </script>
        {% if MeetingResponse is not None %}
            <div id="modal">
                <div>
                    <div class="relative z-10" id="headlessui-dialog-5" role="dialog" aria-modal="true" data-headlessui-state="open">
                        <div class="fixed inset-0 bg-gray-700 bg-opacity-75 transition-opacity opacity-100"></div>
                        <div class="fixed inset-0 z-10 overflow-y-auto">
                            
                            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                                <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg opacity-100 translate-y-0 sm:scale-100" id="headlessui-dialog-panel-6" data-headlessui-state="open">
                                    <div style="position: absolute;right: 1rem;">
                                        <button type="button" class="close-modal text-black-600 text-3xl" data-dismiss="alert" aria-label="Close" onclick="closeModal()"><span aria-hidden="true">&times;</span></button>
                                    </div>
                                    <div class="p-8 grid gap-2">
                                        <div class="h-14 flex justify-center items-center w-full rounded-lg bg-green-100 text-green-600">
                                            Your meeting has been created successfully!</div>
                                        <div class="font-semibold text-gray-600">Meeting id: <span class="font-normal text-gray-700">{{ MeetingResponse.meeting_id }}</span>
                                        </div>
                                        <div class="font-semibold text-gray-600">Meeting passcode: <span class="font-normal text-gray-700">{{MeetingResponse.pcode}} </span>
                                        </div>
                                        <div class="font-semibold text-gray-600">Meeting URL: <span class="font-normal text-gray-700">{{MeetingResponse.joinURL}}</span>
                                        </div>
                                        <div class="flex justify-center"><a href="/joinmeeting/?meeting_id={{MeetingResponse.meeting_id}}&pcode={{MeetingResponse.pcode}} " tabindex="0"><button class="bg-emerald-600 font-semibold px-4 py-2 mt-1 text-white rounded-md">Start
                                                    Meeting</button></a></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <script>
                function closeModal() {
                    var modal = document.getElementById("modal");
                    modal.style.display = "none";
                }
            </script>
            {% endif %}
    </div>
    <script>
        // Schedule a meeting manually
        $(document).ready(function() {
            setTimeout(() => {
                getContactsList(json_encode($ContactsResponse))
            }, 500)
            $("#mySelectParticipants").change((event) => {
                addParticipant(event)
            })
            $("#mySelectModerators").change((event) => {
                addModerator(event)
            })
        })
        $(document).ready(function() {
            localStorage.setItem("attendees", JSON.stringify([]))
            localStorage.setItem("hostusers", JSON.stringify([]))
        })
        $(document).ready(function() {
            $("#close-modal").click(() => {
                document.querySelector("#modal").removeChild('div')
            })
        })
        
    </script>
</body>

</html>